<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Personalized Fitness Agent</title>
    <link rel="stylesheet" href="/static/style.css"/>
</head>
<body>
    <div class="container">
        <h1>Personalized Workout & Diet Planner (AI-like)</h1>
        <form id="profileForm">
            <label>Name: <input type="text" name="name" value="Student"></label>
            <label>Age: <input type="number" name="age" value="22"></label>
            <label>Gender:
                <select name="gender">
                    <option>male</option>
                    <option>female</option>
                    <option>other</option>
                </select>
            </label>
            <label>Height (cm): <input type="number" name="height_cm" value="170"></label>
            <label>Weight (kg): <input type="number" name="weight_kg" value="70"></label>
            <label>Goal:
                <select name="goal">
                    <option>maintain</option>
                    <option>lose weight</option>
                    <option>build muscle</option>
                </select>
            </label>
            <label>Activity level:
                <select name="activity_level">
                    <option value="sedentary">Sedentary</option>
                    <option value="light" selected>Light</option>
                    <option value="moderate">Moderate</option>
                    <option value="active">Active</option>
                    <option value="very active">Very active</option>
                </select>
            </label>
            <label>Cuisine preference:
                <select name="cuisine">
                    <option value="indian" selected>Indian</option>
                    <option value="mediterranean">Mediterranean</option>
                    <option value="asian">Asian</option>
                    <option value="default">Default</option>
                </select>
            </label>
            <label>Budget per day (local currency): <input type="number" name="budget_per_day" value="200"></label>
            <button type="submit">Generate Plan</button>
        </form>

        <div id="result" class="result"></div>
    </div>

    <script>
        const form = document.getElementById('profileForm');
        const result = document.getElementById('result');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(form).entries());
            // convert numeric fields
            data.age = Number(data.age);
            data.height_cm = Number(data.height_cm);
            data.weight_kg = Number(data.weight_kg);
            data.budget_per_day = Number(data.budget_per_day);

            result.innerHTML = "<p>Generating plan...</p>";
            const resp = await fetch('/api/generate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            if (!resp.ok) {
                const e = await resp.json();
                result.innerHTML = '<pre>Error: ' + JSON.stringify(e) + '</pre>';
                return;
            }
            const json = await resp.json();
            renderResult(json);
        });

        function renderResult(json) {
            let html = "<h2>Explanation</h2>";
            html += "<pre>" + json.explanation + "</pre>";

            html += "<h2>Workout (summary)</h2>";
            html += "<p>4-week plan. Showing week 1:</p>";
            const w1 = json.workout.weeks[0];
            html += "<ul>";
            w1.days.forEach(d => {
                html += "<li>Day " + d.day + " ("+d.type+"):<br/><small>" + d.exercises.join(" | ") + "</small></li>";
            });
            html += "</ul>";

            html += "<h2>7-day Meal Plan (summary)</h2>";
            html += "<table><tr><th>Day</th><th>Breakfast</th><th>Lunch</th><th>Dinner</th><th>Snack</th><th>Cal Target</th></tr>";
            json.meal_plan.daily.forEach(d => {
                html += `<tr><td>${d.day}</td><td>${d.meals.breakfast.item} (${d.meals.breakfast.cal} kcal)</td><td>${d.meals.lunch.item} (${d.meals.lunch.cal} kcal)</td><td>${d.meals.dinner.item} (${d.meals.dinner.cal} kcal)</td><td>${d.meals.snack.item} (${d.meals.snack.cal} kcal)</td><td>${d.calories_target}</td></tr>`;
            });
            html += "</table>";

            result.innerHTML = html;
        }
    </script>
</body>
</html>
